<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TriSports ‚Äî Fl√©chettes ‚Ä¢ Ping-pong ‚Ä¢ Palet</title>
  <style>
    :root { --bg:#0f1220; --border:#2b315f; --text:#e7e9f7; --muted:#8b94b8; --chip:#242b55; --card:#1b2242; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;background:radial-gradient(1200px 800px at 20% -10%, #1c2040, transparent),radial-gradient(1000px 600px at 120% 0%, #1b2550, transparent),var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:5;backdrop-filter:saturate(130%) blur(8px);background:linear-gradient(180deg, rgba(15,18,32,.9), rgba(15,18,32,.6));border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:18px 16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 210deg, #6ee7b7, #7aa2ff);display:grid;place-items:center;font-weight:900;color:#0a0d1c}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{background:var(--chip);color:var(--text);border:1px solid var(--border);padding:8px 12px;border-radius:999px;cursor:pointer}
    .tab[aria-selected="true"]{background:linear-gradient(180deg,#1d2a57,#1a2450);border-color:#3a4aa0}
    main .container{padding-top:22px}
    section{display:none} section.active{display:block}
    .card{background:linear-gradient(180deg,#171d3a,#121632);border:1px solid var(--border);border-radius:16px}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:12px}
    .card .bd{padding:16px}
    .muted{color:var(--muted)}
    .btn{appearance:none;border:1px solid var(--border);background:var(--chip);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#2f3da2,#25337d);border-color:#3a4aa0}
    .btn.small{padding:6px 10px;border-radius:10px;font-size:13px}
    .btn.danger{background:linear-gradient(180deg,#7a2b2b,#5c2222);border-color:#8a2b2b}
    .grid{display:grid;gap:12px} .grid.cols-2{grid-template-columns:repeat(2,1fr)} .grid.cols-3{grid-template-columns:repeat(3,1fr)} .grid.cols-4{grid-template-columns:repeat(4,1fr)} .grid.responsive{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    input[type=text],input[type=number],select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0f1331;color:var(--text)}
    label{font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse} th,td{padding:10px 8px;border-bottom:1px solid var(--border);text-align:left} th{color:var(--muted);font-weight:600}
    .match-card{border-radius:14px;border:1px solid var(--border);background:var(--card);overflow:hidden}
    .help{font-size:13px;color:var(--muted)}
    .chip{font-size:12px;padding:4px 8px;background:var(--chip);border:1px solid var(--border);border-radius:999px;color:var(--muted)}
    .pill{padding:4px 8px;border-radius:999px;background:#0f1331;border:1px solid var(--border);color:var(--muted);font-size:12px}
    .avatar{width:40px;height:40px;border-radius:50%;border:1px solid var(--border);background:#0f1331;display:inline-flex;align-items:center;justify-content:center;overflow:hidden;color:#cbd5ff;font-weight:700;font-size:14px;flex:0 0 auto}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .avatar .avatar-initials{display:inline-block;line-height:40px}
    .avatar-lg{width:48px;height:48px;font-size:15px}
    .avatar-lg .avatar-initials{line-height:48px}
    .avatar-sm{width:32px;height:32px;font-size:12px}
    .avatar-sm .avatar-initials{line-height:32px}
    #storage-warning{position:fixed; right:12px; bottom:12px; display:none; background:#0f1331; border:1px solid var(--border); color:var(--muted); border-radius:10px; padding:8px 10px; z-index:99; box-shadow:0 6px 24px rgba(0,0,0,.35)}
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyBSxiTryd0T1Flv15LBdzu31UFvU_I2J7Q",
      authDomain: "trisport-9a7b2.firebaseapp.com",
      databaseURL: "https://trisport-9a7b2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "trisport-9a7b2",
      messagingSenderId: "132024051367",
      appId: "1:132024051367:web:f9aa39785a3d4a43875d82"
    };
  </script>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap">
      <div class="brand">
        <div class="logo">T</div>
        <h1 style="font-size:18px;margin:0">TriSports</h1>
      </div>

      <nav class="tabs" role="tablist" aria-label="Sections" style="flex:1;justify-content:center;display:flex;gap:8px;flex-wrap:wrap">
        <button type="button" class="tab" role="tab" aria-selected="true" data-tab="setup">Tournoi</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="equipes">√âquipes</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="calendrier">Rencontres</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="classement">Classement</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="options">Options</button>
      </nav>

      <div style="display:flex;align-items:center;gap:8px">
        <span id="tname-top" class="pill" title="Nom du tournoi" style="display:none"></span>
        <span id="whoami-top" class="pill">visiteur</span>
        <button type="button" class="btn small" id="btn-fullscreen" title="Plein √©cran (Esc pour quitter)">‚õ∂ Plein √©cran</button>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div id="storage-warning" class="help" style="display:none"></div>

      <!-- 1) Accueil Tournoi -->
      <section id="setup" class="active">
        <div class="grid cols-2">
          <!-- Nouveau tournoi -->
          <div class="card">
            <div class="hd"><strong>Nouveau tournoi</strong></div>
            <div class="bd grid cols-2">
              <div>
                <label>Nom du tournoi</label>
                <input type="text" id="tname-input" placeholder="ex : Tournoi de la plage" />
              </div>
              <div>
                <label>Nombre d'√©quipes</label>
                <input type="number" id="teams-count-input" min="2" max="64" step="1" value="4" />
              </div>
              <div style="grid-column:1/-1;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                <button type="button" class="btn primary" id="btn-create-tournament">Cr√©er</button>
                <span class="help">Prot√©g√© admin (PIN : 30041991).</span>
              </div>
            </div>
          </div>

          <!-- Rejoindre un tournoi (Cloud) -->
          <div class="card">
            <div class="hd"><strong>Rejoindre tournoi existant</strong></div>
            <div class="bd grid">
              <label>Code du tournoi (cloud)</label>
              <input type="text" id="join-code" placeholder="ex : apero2025" />
              <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
                <button type="button" class="btn primary" id="btn-join-code">Rejoindre</button>
                <button type="button" class="btn" id="btn-copy-link">Copier lien ?id=code</button>
                <span class="help">Statut : <span id="cloud-status">hors ligne</span></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Tournois enregistr√©s -->
        <div class="card" style="margin-top:12px">
          <div class="hd"><strong>Tournois enregistr√©s (ce navigateur)</strong></div>
          <div class="bd" id="recent-list">
            <div class="help">Aucun tournoi m√©moris√© pour l‚Äôinstant.</div>
          </div>
        </div>
      </section>

      <!-- 2) √âquipes -->
      <section id="equipes">
        <div class="card">
          <div class="hd">
            <div>
              <strong>√âquipes</strong>
              <div class="help">L‚Äô<b>administrateur</b> cr√©e et √©dite les √©quipes. Les joueurs se connectent √† leur √©quipe pour saisir <b>leurs scores</b> uniquement.</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="pill" id="lock-pill" style="display:none">Calendrier fig√© üîí</span>
              <button type="button" class="btn" id="btn-add-team" style="display:none">+ Ajouter √©quipe (admin)</button>
              <button type="button" class="btn primary" id="btn-generate">G√©n√©rer le calendrier</button>
            </div>
          </div>
          <div class="bd"><div id="team-list" class="grid responsive"></div></div>
        </div>
      </section>

      <!-- 3) Rencontres -->
      <section id="calendrier">
        <div class="card">
          <div class="hd">
            <strong>Rencontres</strong>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="pill" id="stats-matches">0 / 0 matches complets</span>
              <button type="button" class="btn small" id="btn-refresh-standings">Mettre √† jour le classement</button>
              <button type="button" class="btn small" id="btn-collapse">Tout replier</button>
            </div>
          </div>
          <div class="bd"><div id="match-list" class="grid"></div></div>
        </div>
      </section>

      <!-- 4) Classement -->
      <section id="classement">
        <div class="card">
          <div class="hd">
            <strong>Classement</strong>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="pill" id="teams-count">0 √©quipes</span>
              <span class="pill" id="rounds-count">0 matchs par √©quipe</span>
              <button type="button" class="btn small" id="btn-toggle-h2h">Vue face-√†-face</button>
              <button type="button" class="btn small" id="btn-refresh-standings-2">Mettre √† jour</button>
            </div>
          </div>
          <div class="bd" style="overflow:auto">
            <div id="view-summary">
              <div class="help" style="margin-bottom:10px">
                R√®gles ‚Äî Fl√©chettes : 3 parties (2 simples + 1 double), <b>5 pts</b> par partie gagn√©e.
                Ping-pong : 3 parties (2 simples + 1 double), score valide si <b>11+</b> et <b>√©cart ‚â• 2</b>, victoire = <b>5 pts</b>.
                Palet : 1 double √† 11, les points marqu√©s s‚Äôajoutent au total.
              </div>
              <table id="table-classement"><thead><tr><th>#</th><th>√âquipe</th><th>Points</th><th>Fl√©chettes (G)</th><th>Ping-pong (G)</th><th>Palet (PF‚ÄìPA)</th><th>Matchs complets</th></tr></thead><tbody></tbody></table>
            </div>
            <div id="view-h2h" style="display:none">
              <div class="help" style="margin-bottom:10px">Face-√†-face : cliquez sur une cellule pour ouvrir la rencontre.</div>
              <table id="table-h2h" class="h2h-table"><thead></thead><tbody></tbody></table>
            </div>
          </div>
        </div>
      </section>

      <!-- 5) Options -->
      <section id="options">
        <div class="grid cols-2">
          <div class="card">
            <div class="hd"><strong>Exporter / Importer</strong></div>
            <div class="bd grid" style="gap:10px">
              <button type="button" class="btn" id="btn-export">Exporter en JSON</button>
              <input type="file" id="file-import" accept="application/json" />
              <button type="button" class="btn" id="btn-import">Importer le fichier JSON</button>
            </div>
          </div>

          <div class="card">
            <div class="hd"><strong>Acc√®s administrateur</strong></div>
            <div class="bd" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
              <button type="button" class="btn" id="btn-admin-on">Activer admin</button>
              <button type="button" class="btn" id="btn-admin-off">D√©sactiver admin</button>
              <span class="pill" id="whoami">vous : visiteur (lecture seule)</span>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="hd"><strong>R√©initialisation</strong></div>
          <div class="bd grid" style="gap:10px">
            <button type="button" class="btn danger" id="btn-reset">Nouvelle comp√©tition (tout effacer)</button>
            <button type="button" class="btn" id="btn-unlock">üîì D√©verrouiller le calendrier</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script defer src="app.js?v=roles2c14"></script>
</body>
</html>
