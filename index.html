<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TriSports ‚Äî Fl√©chettes ‚Ä¢ Ping-pong ‚Ä¢ Palet</title>
  <style>
    :root { --bg:#0f1220; --border:#2b315f; --text:#e7e9f7; --muted:#8b94b8; --chip:#242b55; --card:#1b2242; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;background:radial-gradient(1200px 800px at 20% -10%, #1c2040, transparent),radial-gradient(1000px 600px at 120% 0%, #1b2550, transparent),var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:5;backdrop-filter:saturate(130%) blur(8px);background:linear-gradient(180deg, rgba(15,18,32,.9), rgba(15,18,32,.6));border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:18px 16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 210deg, #6ee7b7, #7aa2ff);display:grid;place-items:center;font-weight:900;color:#0a0d1c}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{background:var(--chip);color:var(--text);border:1px solid var(--border);padding:8px 12px;border-radius:999px;cursor:pointer}
    .tab[aria-selected="true"]{background:linear-gradient(180deg,#1d2a57,#1a2450);border-color:#3a4aa0}
    main .container{padding-top:22px}
    section{display:none} section.active{display:block}
    .card{background:linear-gradient(180deg,#171d3a,#121632);border:1px solid var(--border);border-radius:16px}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:12px}
    .card .bd{padding:16px}
    .muted{color:var(--muted)}
    .btn{appearance:none;border:1px solid var(--border);background:var(--chip);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#2f3da2,#25337d);border-color:#3a4aa0}
    .btn.small{padding:6px 10px;border-radius:10px;font-size:13px}
    .btn.danger{background:linear-gradient(180deg,#7a2b2b,#5c2222);border-color:#8a2b2b}
    .grid{display:grid;gap:12px} .grid.cols-2{grid-template-columns:repeat(2,1fr)} .grid.cols-3{grid-template-columns:repeat(3,1fr)} .grid.cols-4{grid-template-columns:repeat(4,1fr)} .grid.responsive{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    input[type=text],input[type=number],select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0f1331;color:var(--text)}
    label{font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse} th,td{padding:10px 8px;border-bottom:1px solid var(--border);text-align:left} th{color:var(--muted);font-weight:600}
    .match-card{border-radius:14px;border:1px solid var(--border);background:var(--card);overflow:hidden}
    .match-head{display:flex;justify-content:space-between;align-items:center;padding:12px;gap:8px;cursor:pointer}
    .teams{display:flex;align-items:center;gap:8px;font-weight:600}
    .chip{font-size:12px;padding:4px 8px;background:var(--chip);border:1px solid var(--border);border-radius:999px;color:var(--muted)}
    .pill{padding:4px 8px;border-radius:999px;background:#0f1331;border:1px solid var(--border);color:var(--muted);font-size:12px}
    .caret{transform:rotate(0deg);transition:transform .2s ease}
    .match-card[aria-expanded=true] .caret{transform:rotate(90deg)}
    .match-body{display:none;border-top:1px solid var(--border);padding:12px}
    .match-card[aria-expanded=true] .match-body{display:block}
    .help{font-size:13px;color:var(--muted)}
    .h2h-table th, .h2h-table td { white-space:nowrap; }
    .h2h-badge{display:inline-block;border:1px solid var(--border);border-radius:10px;padding:2px 6px;font-size:12px}
    .h2h-win{background:#0f2b1a;color:#9be7b0;border-color:#1e5f3a}
    .h2h-loss{background:#2b1515;color:#ffb3b3;border-color:#7a2a2a}
    .h2h-pend{background:#141a33;color:#b9c3ef}
    .h2h-clickable{cursor:pointer}

    /* ---------- Avatars (plus gros) ---------- */
    .avatar{width:40px;height:40px;border-radius:50%;border:1px solid var(--border);background:#0f1331;display:inline-flex;align-items:center;justify-content:center;overflow:hidden;color:#cbd5ff;font-weight:700;font-size:14px;flex:0 0 auto}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .avatar .avatar-initials{display:inline-block;line-height:40px}
    .avatar-lg{width:48px;height:48px;font-size:15px}
    .avatar-lg .avatar-initials{line-height:48px}
    .avatar-sm{width:32px;height:32px;font-size:12px}
    .avatar-sm .avatar-initials{line-height:32px}
    .team-name{display:inline-flex;align-items:center;gap:8px}
  </style>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- ‚öôÔ∏è Config Firebase -->
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyBSxiTryd0T1Flv15LBdzu31UFvU_I2J7Q",
      authDomain: "trisport-9a7b2.firebaseapp.com",
      databaseURL: "https://trisport-9a7b2-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "trisport-9a7b2",
      messagingSenderId: "132024051367",
      appId: "1:132024051367:web:f9aa39785a3d4a43875d82"
    };
  </script>
</head>
<body>
  <header>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap">
      <div class="brand">
        <div class="logo">T</div>
        <h1 style="font-size:18px;margin:0">TriSports</h1>
      </div>
      <nav class="tabs" role="tablist" aria-label="Sections">
        <button type="button" class="tab" role="tab" aria-selected="true" data-tab="equipes">√âquipes</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="calendrier">Rencontres</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="classement">Classement</button>
        <button type="button" class="tab" role="tab" aria-selected="false" data-tab="options">Options</button>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <div id="storage-warning" class="help" style="display:none;margin-bottom:12px;border:1px dashed var(--border);border-radius:12px;padding:10px 12px;background:#0f1331"></div>

      <!-- √âquipes -->
      <section id="equipes" class="active">
        <div class="card">
          <div class="hd">
            <div>
              <strong>√âquipes</strong>
              <div class="help">Les <b>administrateurs</b> cr√©ent et √©ditent les √©quipes. Les joueurs se <b>connectent</b> √† leur √©quipe avec un mot de passe pour saisir <b>leurs scores uniquement</b>.</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="pill" id="lock-pill" style="display:none">Calendrier fig√© üîí</span>
              <button type="button" class="btn" id="btn-add-team" style="display:none">+ Ajouter √©quipe (admin)</button>
              <button type="button" class="btn primary" id="btn-generate">G√©n√©rer le calendrier</button>
            </div>
          </div>
          <div class="bd"><div id="team-list" class="grid responsive"></div></div>
        </div>
      </section>

      <!-- Rencontres -->
      <section id="calendrier">
        <div class="card">
          <div class="hd">
            <strong>Rencontres</strong>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="pill" id="stats-matches">0 / 0 matches complets</span>
              <button type="button" class="btn small" id="btn-refresh-standings">Mettre √† jour le classement</button>
              <button type="button" class="btn small" id="btn-expand">Tout d√©ployer</button>
              <button type="button" class="btn small" id="btn-collapse">Tout replier</button>
            </div>
          </div>
          <div class="bd"><div id="match-list" class="grid"></div></div>
        </div>
      </section>

      <!-- Classement -->
      <section id="classement">
        <div class="card">
          <div class="hd">
            <strong>Classement</strong>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="pill" id="teams-count">0 √©quipes</span>
              <span class="pill" id="rounds-count">0 matchs par √©quipe</span>
              <button type="button" class="btn small" id="btn-toggle-h2h">Vue face-√†-face</button>
              <button type="button" class="btn small" id="btn-refresh-standings-2">Mettre √† jour</button>
            </div>
          </div>
          <div class="bd" style="overflow:auto">
            <div id="view-summary">
              <div class="help" style="margin-bottom:10px">
                R√®gles ‚Äî Fl√©chettes : 3 parties (2 simples + 1 double), <b>5 pts</b> par partie gagn√©e.
                Ping-pong : 3 parties (2 simples + 1 double), victoire = <b>5 pts</b> (score valide si <b>11+</b> et <b>√©cart ‚â• 2</b>).
                Palet : 1 double √† 11, les points marqu√©s s‚Äôajoutent au total.
              </div>
              <table id="table-classement"><thead><tr><th>#</th><th>√âquipe</th><th>Points</th><th>Fl√©chettes (G)</th><th>Ping-pong (G)</th><th>Palet (PF‚ÄìPA)</th><th>Matchs complets</th></tr></thead><tbody></tbody></table>
            </div>
            <div id="view-h2h" style="display:none">
              <div class="help" style="margin-bottom:10px">Face-√†-face : cliquez sur une cellule pour ouvrir la rencontre.</div>
              <table id="table-h2h" class="h2h-table"><thead></thead><tbody></tbody></table>
            </div>
          </div>
        </div>
      </section>

      <!-- Options -->
      <section id="options">
        <div class="grid cols-2">
          <div class="card">
            <div class="hd"><strong>Exporter / Importer</strong></div>
            <div class="bd grid" style="gap:10px">
              <button type="button" class="btn" id="btn-export">Exporter en JSON</button>
              <input type="file" id="file-import" accept="application/json" />
              <button type="button" class="btn" id="btn-import">Importer le fichier JSON</button>
              <hr style="border:none;border-top:1px dashed var(--border)">
              <button type="button" class="btn" id="btn-share">Cr√©er un lien de partage (offline)</button>
              <input type="text" id="share-url" readonly placeholder="Le lien appara√Ætra ici" />
            </div>
          </div>

          <div class="card">
            <div class="hd"><strong>Cloud (live) ‚Äî droits selon votre r√¥le</strong></div>
            <div class="bd grid" style="gap:10px">
              <label>Code tournoi</label>
              <input type="text" id="cloud-id" placeholder="ex: apero2025" />
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <button type="button" class="btn primary" id="btn-cloud-join">Cr√©er / Rejoindre</button>
                <button type="button" class="btn" id="btn-cloud-copy">Copier lien ?id=code</button>
                <button type="button" class="btn" id="btn-cloud-leave">Se d√©connecter</button>
              </div>
              <div class="help">Statut : <span id="cloud-status">hors ligne</span></div>

              <hr style="border:none;border-top:1px dashed var(--border)">
              <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
                <button type="button" class="btn" id="btn-admin-on">Activer mode administrateur</button>
                <button type="button" class="btn" id="btn-admin-off">D√©sactiver admin</button>
                <span class="pill" id="whoami">vous : visiteur (lecture seule)</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="hd"><strong>R√©initialisation</strong></div>
          <div class="bd grid" style="gap:10px">
            <button type="button" class="btn danger" id="btn-reset">Nouvelle comp√©tition (tout effacer)</button>
            <button type="button" class="btn" id="btn-unlock">üîì D√©verrouiller le calendrier</button>
          </div>
        </div>

        <div class="help" style="text-align:center;padding:18px">Les mots de passe d‚Äô√©quipe sont d√©finis par l‚Äôadministrateur. Les joueurs se connectent √† leur √©quipe pour modifier uniquement leurs matchs.</div>
      </section>
    </div>
  </main>

  <script defer src="app.js?v=roles2c6"></script>
</body>
</html>
