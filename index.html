<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>TriSports — Fléchettes • Ping-pong • Palet</title>

<!-- Garde-fou : certaines extensions injectent du React minifié qui loggue "Minified React error #...".
     On évite que ça remonte et perturbe l'app (ça n'affecte PAS ton site). -->

<script>
(function(){
  function withFallback(img, primary, fall1, fall2){
    img.src = primary;
    img.onerror = function(){
      img.onerror = function(){
        img.onerror = function(){
          img.onerror = null;
          img.src = fall2;
        };
        img.src = fall1;
      };
      img.src = 'img/' + primary.split('/').pop();
    };
  }
  function ensureBrandImages(){
    var brand = document.querySelector('header .brand') || document.querySelector('.brand');
    if(!brand) return;
    if(!brand.querySelector('img.brand-logo')){
      var logo = document.createElement('img');
      logo.className = 'brand-logo';
      logo.alt = 'TriSports logo';
      brand.prepend(logo);
      withFallback(logo, 'tripsort/img/logo.png', 'trisport/img/logo.png', 'img/logo.png');
    }
    if(!brand.querySelector('img.brand-title')){
      var title = document.createElement('img');
      title.className = 'brand-title';
      title.alt = 'TriSports';
      var ref = brand.querySelector('img.brand-logo');
      if(ref && ref.nextSibling){ brand.insertBefore(title, ref.nextSibling); }
      else { brand.appendChild(title); }
      withFallback(title, 'tripsort/img/titre.png', 'trisport/img/titre.png', 'img/titre.png');
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureBrandImages);
  }else{
    ensureBrandImages();
  }
  // garder la réécriture d'aide capitaine en async léger
  document.addEventListener('click', function(){ if (typeof rewriteCapitaineHelp==='function') setTimeout(rewriteCapitaineHelp,0); }, true);
  
  // --- Affichage après révélation : ne pas afficher joueur/sport pour Capitaine ---
  if (typeof window.bonusChip === 'function'){
    const _origChip = window.bonusChip;
    window.bonusChip = function(r, mTeam, rs){
      const html = _origChip(r, mTeam, rs);
      if (typeof html === 'string' && /Capitaine\s*:?\s*J\d/i.test(html)){
        return html.replace(/Capitaine\s*:?\s*J\d\s*\/\s*(Fléchettes|Ping|Palet)/i, 'Capitaine');
      }
      return html;
    };
  }
})();
</script>
<script id="matchcard-animations-js">
(function(){
  function getPanel(card){
    return card && card.querySelector('.bd');
  }
  function animateOpen(card){
    const panel = getPanel(card);
    if(!panel) return;
    // Ensure visible style before measuring
    panel.style.display = 'block';
    // From current height (0 || set) to scrollHeight
    panel.style.maxHeight = panel.scrollHeight + 'px';
    panel.style.opacity = '1';
    panel.style.paddingTop = '';
    panel.style.paddingBottom = '';
    function onEnd(e){
      if(e.propertyName === 'max-height'){
        panel.style.maxHeight = 'none'; // natural height
        panel.removeEventListener('transitionend', onEnd);
      }
    }
    panel.addEventListener('transitionend', onEnd);
  }
  function animateClose(card){
    const panel = getPanel(card);
    if(!panel) return;
    // If currently 'none', set to current measured height for transition start
    if(getComputedStyle(panel).maxHeight === 'none'){
      panel.style.maxHeight = panel.scrollHeight + 'px';
    }
    // Force reflow to apply starting height
    panel.getBoundingClientRect();
    // Then animate to 0
    panel.style.maxHeight = '0px';
    panel.style.opacity = '0';
    panel.style.paddingTop = '0px';
    panel.style.paddingBottom = '0px';
  }

  // Observe aria-expanded changes to trigger animation
  const cards = Array.from(document.querySelectorAll('.match-card'));
  const obs = new MutationObserver((mutations)=>{
    mutations.forEach(m=>{
      if(m.type === 'attributes' && m.attributeName === 'aria-expanded'){
        const card = m.target;
        const isOpen = card.getAttribute('aria-expanded') === 'true';
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches){
          // No animation, just set styles minimally
          const p = getPanel(card);
          if(!p) return;
          if(isOpen){
            p.style.maxHeight = 'none'; p.style.opacity = '1'; p.style.paddingTop=''; p.style.paddingBottom=''; p.style.display='block';
          }else{
            p.style.maxHeight = '0px'; p.style.opacity = '0'; p.style.paddingTop='0'; p.style.paddingBottom='0'; p.style.display='block';
          }
          return;
        }
        if (isOpen) animateOpen(card); else animateClose(card);
      }
    });
  });
  cards.forEach(card=>{
    obs.observe(card, { attributes:true, attributeFilter:['aria-expanded'] });
    // Make header clickable/toggleable if not already
    const hd = card.querySelector('.hd');
    if(hd){
      hd.style.cursor = 'pointer';
      hd.setAttribute('tabindex','0');
      hd.setAttribute('role','button');
      const toggle = (ev)=>{
        if(ev && ev.type==='keydown' && !(ev.key==='Enter' || ev.key===' ')) return;
        const open = card.getAttribute('aria-expanded') !== 'true';
        card.setAttribute('aria-expanded', open ? 'true' : 'false');
        if(ev) ev.preventDefault();
      };
      hd.addEventListener('click', toggle);
      hd.addEventListener('keydown', toggle);
    }
    // Initialize panel style according to current state
    const isOpen = card.getAttribute('aria-expanded') === 'true';
    const p = getPanel(card);
    if(p){
      if(isOpen){
        p.style.maxHeight = 'none';
        p.style.opacity = '1';
      }else{
        p.style.maxHeight = '0px';
        p.style.opacity = '0';
        p.style.paddingTop='0';
        p.style.paddingBottom='0';
        p.style.display='block';
      }
    }
  });

  // Hook into "Tout replier" button if present
  const collapseBtn = document.getElementById('btn-collapse');
  if(collapseBtn){
    collapseBtn.addEventListener('click', ()=>{
      document.querySelectorAll('.match-card[aria-expanded="true"]').forEach(c=>c.setAttribute('aria-expanded','false'));
    });
  }
})();
</script>
<script id="standings-count-anim">
(function(){
  const TBL = document.getElementById('table-classement');
  if(!TBL) return;

  const isReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const DURATION = isReduced ? 0 : 600;

  function numFromText(t){
    if(!t) return null;
    const m = (''+t).replace(',', '.').match(/-?\d+(?:\.\d+)?/);
    return m ? parseFloat(m[0]) : null;
  }
  function formatLike(orig, n){
    const hasPlus = /^\s*\+/.test(orig);
    const s = Math.round(n).toString();
    return hasPlus ? (n>=0? '+' : '') + Math.round(n).toString() : s;
  }
  function animateCount(cell, from, to){
    if (DURATION === 0){ cell.textContent = formatLike(cell.textContent, to); return; }
    const start = performance.now();
    function step(now){
      const p = Math.min(1, (now - start) / DURATION);
      const eased = 1 - Math.pow(1 - p, 3);
      const val = from + (to - from) * eased;
      if (cell && cell.isConnected){
        cell.textContent = formatLike(cell.textContent, val);
      }
      if (p < 1 && cell && cell.isConnected) requestAnimationFrame(step);
      else if (cell && cell.isConnected) cell.textContent = formatLike(cell.textContent, to);
    }
    requestAnimationFrame(step);
  }

  const tbody = TBL.querySelector('tbody');
  if(!tbody) return;

  function initRow(tr){
    if (!tr || !tr.children) return;
    const pts = tr.children[2];
    const bon = tr.children[6];
    const mal = tr.children[7];
    if (pts) pts.dataset.prev = pts.textContent.trim();
    if (bon) bon.dataset.prev = bon.textContent.trim();
    if (mal) mal.dataset.prev = mal.textContent.trim();
  }

  Array.from(tbody.querySelectorAll('tr')).forEach(initRow);

  const mo = new MutationObserver((ms)=>{
    ms.forEach(m=>{
      if (m.type === 'characterData'){
        const parent = m.target && m.target.parentElement ? m.target.parentElement : null;
        if (!parent || !parent.parentElement) return;
        const tr = parent.parentElement;
        if (!tr || !tr.children) return;
        const colIndex = Array.from(tr.children).indexOf(parent);
        if (![2,6,7].includes(colIndex)) return;
        const prevText = parent.dataset.prev || '';
        const newText = parent.textContent.trim();
        const from = numFromText(prevText);
        const to = numFromText(newText);
        if (from==null || to==null || from===to){ parent.dataset.prev = newText; return; }
        parent.textContent = prevText;
        animateCount(parent, from, to);
        parent.dataset.prev = newText;
      }
      if (m.type === 'childList'){
        m.addedNodes.forEach(node=>{
          if(!(node && node.nodeType===1)) return;
          if (node.matches && node.matches('tr')){
            const tr = node;
            tr.style.animation = 'slideUpFade .28s ease both';
            const parent = tr.parentElement || (m.target && m.target.nodeType===1 ? m.target : null);
            if (parent && parent.children){
              const idx = Array.from(parent.children).indexOf(tr);
              tr.style.animationDelay = (Math.min(6, Math.max(0, idx)) * 0.03).toFixed(2) + 's';
            }
            initRow(tr);
          }else{
            node.querySelectorAll && node.querySelectorAll('tr').forEach(initRow);
          }
        });
      }
    });
  });
  mo.observe(tbody, { subtree:true, characterData:true, childList:true });

  function pulse(){
    TBL.style.boxShadow='0 0 0 1px rgba(122,162,255,.25) inset';
    setTimeout(()=>{ if (TBL) TBL.style.boxShadow=''; }, 250);
  }
  const r1 = document.getElementById('btn-refresh-standings');
  const r2 = document.getElementById('btn-refresh-standings-2');
  r1 && r1.addEventListener('click', pulse);
  r2 && r2.addEventListener('click', pulse);
})();
</script>
<div aria-hidden="true" id="confirm-overlay"><div class="confirm-card"><div class="hd"><span class="icon"></span>Confirmation</div><div class="bd">Êtes-vous sûr ?</div><div class="ft"><button class="btn" type="button">Annuler</button><button class="btn primary" type="button">Confirmer</button></div></div></div><script id="confirm-modal-logic">
(function(){
  // Build a Promise-based confirm
  window.showConfirm = function(opts){
    opts = opts || {};
    var overlay = document.getElementById('confirm-overlay');
    var icon = overlay.querySelector('.icon');
    var title = overlay.querySelector('.hd');
    var body = overlay.querySelector('.bd');
    var btns = overlay.querySelectorAll('.ft .btn');
    var btnCancel = btns[0], btnOk = btns[1];

    // Title text (keep icon span intact)
    overlay.querySelector('.hd').childNodes[1].nodeValue = opts.title || 'Confirmation';
    icon.textContent = opts.icon || '⚠️';
    body.textContent = opts.message || 'Êtes-vous sûr ?';
    btnOk.textContent = opts.okText || 'Confirmer';
    btnCancel.textContent = opts.cancelText || 'Annuler';
    btnOk.classList.toggle('danger', !!opts.danger);

    return new Promise(function(resolve){
      function close(res){
        overlay.classList.remove('show');
        document.removeEventListener('keydown', esc);
        btnCancel.removeEventListener('click', onCancel);
        btnOk.removeEventListener('click', onOk);
        resolve(res);
      }
      function esc(e){ if(e.key==='Escape') close(false); }
      function onCancel(){ close(false); }
      function onOk(){ close(true); }

      document.addEventListener('keydown', esc);
      btnCancel.addEventListener('click', onCancel);
      btnOk.addEventListener('click', onOk);
      overlay.classList.add('show');
      btnOk.focus();
    });
  };

  // Intercept clicks on sensitive actions with a capturing listener
  var pass = false;
  document.addEventListener('click', function(ev){
    var btn = ev.target.closest && (
      ev.target.closest('[data-clear]') ||
      ev.target.closest('#btn-start-round') ||
      ev.target.closest('#btn-end-round')
    );
    if(!btn) return;
    if(pass){ pass = false; return; } // let it through once

    // Prevent original handlers
    ev.stopImmediatePropagation();
    ev.preventDefault();

    // Derive context
    var isClear = !!btn.closest('[data-clear]');
    var isStart = btn.id === 'btn-start-round';
    var isEnd   = btn.id === 'btn-end-round';

    var cfg = isClear ? {
      title: 'Effacer ce match ?',
      icon: '🗑️',
      message: 'Cette action remettra à zéro Fléchettes, Ping et Palet pour ce match. Continuer ?',
      okText: 'Oui, effacer',
      danger: true
    } : isStart ? {
      title: 'Démarrer la journée ?',
      icon: '🏁',
      message: 'Vous êtes sur le point d’ouvrir la journée. Les équipes pourront saisir leurs scores. Confirmer ?',
      okText: 'Démarrer'
    } : {
      title: 'Clôturer la journée ?',
      icon: '🔒',
      message: 'Vous allez passer la journée en “terminée”. Les équipes ne pourront plus modifier les scores (sauf admin). Confirmer ?',
      okText: 'Clore',
      danger: true
    };

    showConfirm(cfg).then(function(ok){
      if(!ok) return;
      // Allow a single pass-through click to trigger the app's existing handler
      pass = true;
      btn.click();
    });
  }, true); // capture phase to beat existing listeners
})();
</script>
<!-- Password Modal -->
<div aria-hidden="true" id="password-overlay" style="position:fixed;inset:0;display:none;z-index:9999;background: rgba(10,12,24,.55); -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);">
  <div class="confirm-card" role="dialog" aria-modal="true" aria-labelledby="password-title" style="margin:0 auto;">
    <div class="hd"><span class="icon">🔑</span><span id="password-title">Mot de passe</span></div>
    <div class="bd">
      <p id="password-message">Entrez votre mot de passe :</p>
      <div id="password-field-wrap" style="position:relative;display:block;">
        <input id="password-input" style="padding-right:44px;" type="password" autocomplete="current-password" placeholder="Mot de passe" /> <button id="password-toggle" type="button" aria-label="Afficher le mot de passe" tabindex="0" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);width:28px;height:28px;display:inline-grid;place-items:center;border-radius:999px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);backdrop-filter:blur(2px);" style="margin-left:8px;padding:4px 6px;cursor:pointer;border-radius:4px;border:1px solid rgba(0,0,0,0.08);background:transparent">👁️</button>
      </div>
    <div class="ft">
      <button class="btn" type="button" id="password-cancel">Annuler</button>
      <button class="btn primary" type="button" id="password-ok">Valider</button>
    </div>
  </div>
</div>
<script id="password-modal-logic">
(function(){
  window.showPassword = function(opts){
    opts = opts || {};
    var overlay = document.getElementById('password-overlay');
    var title = document.getElementById('password-title');
    var msg = document.getElementById('password-message');
    var input = document.getElementById('password-input');
    var btnOk = document.getElementById('password-ok');
    var btnCancel = document.getElementById('password-cancel');
    title.textContent = opts.title || 'Mot de passe';
    msg.textContent = opts.message || 'Entrez votre mot de passe :';
    input.value = '';
    input.placeholder = opts.placeholder || 'Mot de passe';
    overlay.classList.add('show');
    overlay.style.display = 'grid';
    input.focus();
    var toggle = document.getElementById('password-toggle');
    if(toggle){
      // reset to masked each time
      input.type = 'password';
      toggle.textContent = '👁️';
      toggle.setAttribute('aria-label','Afficher le mot de passe');
      toggle.addEventListener('click', function(ev){
        ev.preventDefault();
        var cur = input.getAttribute('type');
        if(cur === 'password'){
          input.setAttribute('type','text');
          toggle.textContent = '🙈';
          toggle.setAttribute('aria-label','Masquer le mot de passe');
          toggle.setAttribute('aria-pressed','true');
        }else{
          input.setAttribute('type','password');
          toggle.textContent = '👁️';
          toggle.setAttribute('aria-label','Afficher le mot de passe');
          toggle.setAttribute('aria-pressed','false');
        }
      });
    }
    return new Promise(function(resolve){
      function close(val){
        overlay.classList.remove('show');
        overlay.style.display = 'none';
        btnOk.removeEventListener('click', onOk);
        btnCancel.removeEventListener('click', onCancel);
        overlay.removeEventListener('click', onBackdrop);
        document.removeEventListener('keydown', onKey);
        resolve(val);
      }
      function onOk(){ close(input.value); }
      function onCancel(){ close(null); }
      function onBackdrop(e){ if (e.target === overlay) onCancel(); }
      function onKey(e){
        if(e.key === 'Enter'){ e.preventDefault(); onOk(); }
        if(e.key === 'Escape'){ e.preventDefault(); onCancel(); }
      }
      btnOk.addEventListener('click', onOk);
      btnCancel.addEventListener('click', onCancel);
      overlay.addEventListener('click', onBackdrop);
      document.addEventListener('keydown', onKey);
    });
  };
})();
</script>
<div class="toast" id="toast"></div><script id="toast-logic">
(function(){
  window.showToast = function(msg, timeout){
    timeout = timeout || 2600;
    var el = document.getElementById('toast');
    if(!el) return alert(msg);
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(el._t);
    el._t = setTimeout(function(){ el.classList.remove('show'); }, timeout);
  };
})();
</script><script id="boot-title-who">
(function(){
  try{
    if (typeof renderTitle === 'function') renderTitle();
    if (typeof updateWho === 'function')  updateWho();
  }catch(e){ /* silent */ }
})();
</script><script id="points-column-script-medallion-hook">
(function(){
  function wrapPoints(){
    var t = document.getElementById('table-classement');
    if(!t) return;
    t.querySelectorAll('tbody td:nth-child(3)').forEach(function(td){
      var v = (td.textContent || "").trim();
      var span = td.querySelector('span.points-medal');
      if (span) {
        span.textContent = v;
      } else if (v) {
        td.textContent = "";
        var s = document.createElement('span');
        s.className = 'points-medal';
        s.textContent = v;
        td.appendChild(s);
      }
    });
  }
  function patch(){
    var orig = window.renderLeaderboard;
    if (typeof orig === 'function'){
      if (!orig._withPointsWrap){
        window.renderLeaderboard = function(){
          var r = orig.apply(this, arguments);
          requestAnimationFrame(wrapPoints);
          return r;
        };
        window.renderLeaderboard._withPointsWrap = true;
      }
      requestAnimationFrame(wrapPoints);
    } else {
      setTimeout(patch, 120);
    }
  }
  // Réappliquer quand on affiche l’onglet Classement
  document.addEventListener('click', function(ev){
    var btn = ev.target.closest && ev.target.closest('.tab[data-tab="classement"]');
    if (btn){ requestAnimationFrame(function(){ setTimeout(wrapPoints, 0); }); }
  });
  patch();
})();
</script>
<script id="bonus-pop-autoplace">
(function(){
  function getScoreRect(root){
    var score = root.closest('.match-card')?.querySelector('.scorewrap .score, .score') ||
                document.querySelector('.scorewrap .score, .score');
    return score ? score.getBoundingClientRect() : null;
  }
  
  function place(pop, pill){
    // reset
    pop.classList.remove('is-above');
    pop.style.setProperty('--x-offset', '0px');

    var popRect   = pop.getBoundingClientRect();
    var pillRect  = pill.getBoundingClientRect();
    var scoreRect = getScoreRect(pill);

    if (!scoreRect){
      if (popRect.top < 8) pop.classList.add('is-above');
      return;
    }

    var overlapVert = !(popRect.bottom < scoreRect.top || popRect.top > scoreRect.bottom);
    if (overlapVert){
      pop.classList.add('is-above');
      popRect = pop.getBoundingClientRect();
    }

    var margin = 8;
    var needLeft  = Math.max(0, scoreRect.left  - popRect.left  + margin);
    var needRight = Math.max(0, popRect.right   - scoreRect.right + margin);

    var dx = 0;
    if (needLeft === 0 && needRight === 0){
      dx = 0;
    } else if (needRight > 0 && needLeft <= 0){
      dx = -needRight;
    } else if (needLeft > 0 && needRight <= 0){
      dx = needLeft;
    } else {
      var scoreCenter = (scoreRect.left + scoreRect.right) / 2;
      dx = (pillRect.left < scoreCenter) ? needLeft : -needRight;
    }

    var newLeft  = popRect.left  + dx;
    var newRight = popRect.right + dx;
    if (newLeft < 16) dx += (16 - newLeft);
    if (newRight > window.innerWidth - 16) dx -= (newRight - (window.innerWidth - 16));

    pop.style.setProperty('--x-offset', dx.toFixed(0) + 'px');
  }

function onEnter(e){
    var pill = (function(t){var el=t; if(el&&el.nodeType&&el.nodeType!==1) el=el.parentElement; while(el){ if(el.matches&&el.matches('.pill.bonus-flashy')) return el; el=el.parentElement; } return null;})(e.target);
    if (!pill) return;
    var pop = pill.querySelector('.bonus-pop');
    if (!pop) return;
    requestAnimationFrame(function(){ place(pop, pill); });
  }
  function onLeave(e){
    var pill = (function(t){var el=t; if(el&&el.nodeType&&el.nodeType!==1) el=el.parentElement; while(el){ if(el.matches&&el.matches('.pill.bonus-flashy')) return el; el=el.parentElement; } return null;})(e.target);
    if (!pill) return;
    var pop = pill.querySelector('.bonus-pop');
    if (!pop) return;
    pop.classList.remove('is-above');
    pop.style.removeProperty('--x-offset');
  }
  document.addEventListener('mouseenter', onEnter, true);
  document.addEventListener('mouseleave', onLeave, true);
})();
</script>

<script>
// === Bonus tooltip — large, hover only (fixed to body) ===================
(function bonusTooltipHoverOnly(){
  const DESCS = {
    "Capitaine": "Aucun réglage. +2 par manche gagnée (fléchettes & ping, simples et doubles) et +2 si palet gagné.",
    "Miroir": "Inverse le bonus adverse sur tout le match. Si l’adversaire choisit Capitaine, son effet s’applique à votre équipe.",
    "René la taupe": "Lunettes gênantes imposées à l’adversaire dans le sport choisi. Si l’adversaire joue « Miroir », vous portez les lunettes.",
    "10 pouces 2 mains gauche": "L’adversaire doit jouer un sous-match avec sa mauvaise main. Choisissez le sport concerné.",
    "Melon d'or": "Nouveau bonus — détails à venir."
  };

  // Single tooltip node (no backdrop)
  const tip = document.createElement('div');
  tip.className = 'bonus-tip floating';
  tip.style.position = 'fixed';
  tip.style.zIndex = '99999';
  tip.style.display = 'none';
  tip.innerHTML = '<span class="tip-img"></span><span><div class="tip-title"></div><div class="tip-desc"></div></span>';
  document.body.appendChild(tip);

  const imgBox = tip.querySelector('.tip-img');
  const tTitle = tip.querySelector('.tip-title');
  const tDesc  = tip.querySelector('.tip-desc');
  let anchor = null;    // current pill
  let overTip = false;  // track hover inside the tip

  function fill(pill){
    const img = pill.dataset?.bonusImg || pill.querySelector?.('.mini-bonus img')?.getAttribute('src') || '';
    const title = pill.dataset?.bonusTitle || pill.getAttribute?.('aria-label') || (pill.textContent || '').trim();
    const desc  = pill.dataset?.bonusDesc || DESCS[title] || '';
    imgBox.innerHTML = img ? '<img src="'+img+'" alt="" />' : '';
    tTitle.textContent = title || 'Bonus';
    tDesc.textContent  = desc;
  }

  function place(pill){
    const r = pill.getBoundingClientRect();
    tip.style.display = 'grid';
    tip.style.opacity = '0';
    tip.classList.remove('show');
    requestAnimationFrame(()=>{
      const w = tip.offsetWidth;
      const h = tip.offsetHeight;
      let x = Math.round(r.left + r.width/2 - w/2);
      let y = Math.round(r.top - h - 10);
      const margin = 10;
      if (x < margin) x = margin;
      if (x + w > window.innerWidth - margin) x = window.innerWidth - margin - w;
      if (y < margin) y = Math.round(r.bottom + 10);
      tip.style.left = x + 'px';
      tip.style.top  = y + 'px';
      tip.style.opacity = '1';
      tip.classList.add('show');
    });
  }

  function show(pill){ anchor = pill; fill(pill); place(pill); }
  function hide(){
    if (!overTip) { tip.style.display = 'none'; tip.classList.remove('show'); anchor = null; }
  }

  // Keep visible while mouse moves over the tooltip
  tip.addEventListener('mouseenter', ()=>{ overTip = true; });
  tip.addEventListener('mouseleave', ()=>{ overTip = false; hide(); });

  function attach(pill){
    if (!pill || pill.dataset.btipReady) return;
    pill.dataset.btipReady = '1';
    if (!pill.hasAttribute('tabindex')) pill.setAttribute('tabindex','0');
    pill.addEventListener('mouseenter', ()=>show(pill));
    pill.addEventListener('mouseleave', (e)=>{
      const to = e.relatedTarget;
      if (!tip.contains(to)) hide();
    });
    pill.addEventListener('focus', ()=>show(pill));
    pill.addEventListener('blur', hide);
    // No click/touch needed
  }

  function enhanceAll(root){
    (root || document).querySelectorAll('.pill').forEach(p=>{
      if (p.querySelector('.mini-bonus img')) attach(p);
    });
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ()=>enhanceAll(document));
  } else {
    enhanceAll(document);
  }

  try{
    const mo = new MutationObserver(()=>enhanceAll(document));
    mo.observe(document.body, { childList:true, subtree:true });
  }catch(_){}

  window.refreshBonusTooltips = enhanceAll;
})();
</script>

<style id="bonus-boost-style">
/* === Bonus posé — visibles UNIQUEMENT pour la journée en cours (chip .yellow) === */
/* On cible les pilules rendues AVANT la fin de journée :
   - '.pill.pill--blue' (aperçu sans valeur)
   ET seulement quand l'en-tête de la journée a le badge .round-chip.yellow
   -> .round-head:has(.round-chip.yellow) + .round-grid ...
*/
.round-head:has(.round-chip.yellow) + .round-grid .pill.pill--blue{
  position: relative;
  color: #f7fbff !important;
  background: linear-gradient(135deg, rgb(35,153,242) 0%, rgb(28,107,224) 100%) !important;
  border: 1px solid rgba(35,153,242,.55) !important;
  text-shadow: 0 0 2px rgba(28,107,224,.35);
  box-shadow:
    0 0 6px rgba(35,153,242,.24),
    0 0 18px rgba(35,153,242,.18),
    inset 0 0 6px rgba(255,255,255,.06) !important;
  animation: neonPulseBlue 1.5s ease-in-out infinite;
}
.round-head:has(.round-chip.yellow) + .round-grid .pill.pill--blue::before{
  content: "";
  position: absolute;
  inset: -6px;
  border-radius: 999px;
  pointer-events: none;
  box-shadow:
    0 0 0 0 rgba(35,153,242,.45),
    0 0 22px rgba(35,153,242,.28);
  animation: neonHaloBlue 1.4s ease-in-out infinite;
  opacity: .7;
}
.round-head:has(.round-chip.yellow) + .round-grid .pill.pill--blue::after{
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(circle at 18% -10%, rgba(255,255,255,.18), transparent 35%);
  pointer-events: none;
}

@keyframes neonPulseBlue{
  0%, 100%{ filter: brightness(1); }
  50%{ filter: brightness(1.08); }
}
@keyframes neonHaloBlue{
  0%{ transform: scale(1); opacity:.6; box-shadow: 0 0 0 0 rgba(35,153,242,.45), 0 0 20px rgba(35,153,242,.25); }
  70%{ transform: scale(1.18); opacity:0; box-shadow: 0 0 0 12px rgba(35,153,242,0), 0 0 28px rgba(35,153,242,.08); }
  100%{ transform: scale(1); opacity:0; }
}
@media (prefers-reduced-motion: reduce){
  .round-head:has(.round-chip.yellow) + .round-grid .pill.pill--blue{ animation: none !important; }
  .round-head:has(.round-chip.yellow) + .round-grid .pill.pill--blue::before{ animation: none !important; opacity: .4; }
}
</style>
</body>
<style id="pretty-confirm-modal">
/* === Pretty Confirm Modal ============================================ */
#confirm-overlay{
  position: fixed; inset: 0; display: none; z-index: 9999;
  background: rgba(10,12,24,.55); -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
}
#confirm-overlay.show{ display: grid; place-items: center; }

.confirm-card{
  width: min(520px, 92vw);
  background: linear-gradient(180deg,#151b39,#121632);
  border: 1px solid #2b315f;
  border-radius: 16px;
  box-shadow: 0 18px 36px rgba(0,0,0,.45); /* keep existing shadow */
  color: #e7e9f7;
  transform: translateY(6px) scale(.98);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
}
#confirm-overlay.show .confirm-card{
  transform: translateY(0) scale(1);
  opacity: 1;
}
.confirm-card .hd{ padding: 14px 16px; border-bottom: 1px solid #2b315f; font-weight: 800; display:flex; gap:10px; align-items:center; }
.confirm-card .bd{ padding: 16px; color: #cbd5ff; }
.confirm-card .ft{ padding: 12px 16px; border-top: 1px solid #2b315f; display:flex; gap:8px; justify-content: flex-end; }
.confirm-card .btn{ padding: 10px 14px; border-radius: 12px; }
.confirm-card .btn.primary{ background: linear-gradient(180deg,#2f3da2,#25337d); border-color:#3a4aa0; }
.confirm-card .btn.danger{ background: linear-gradient(180deg,#7a2b2b,#5c2222); border-color:#8a2b2b; }
.confirm-card .icon{ width: 22px; height: 22px; display:grid; place-items:center; font-size:18px; }

/* Password overlay mirrors confirm overlay */
#password-overlay{
  position: fixed; inset: 0; display: none; z-index: 9999;
  background: rgba(10,12,24,.55); -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
}
#password-overlay.show{ display: grid; place-items: center; }
#password-overlay .confirm-card{
  width: min(520px, 92vw);
  background: linear-gradient(180deg,#151b39,#121632);
  border: 1px solid #2b315f;
  border-radius: 16px;
  box-shadow: 0 18px 36px rgba(0,0,0,.45);
  color: #e7e9f7;
  transform: translateY(6px) scale(.98);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
}
#password-overlay.show .confirm-card{
  transform: translateY(0) scale(1);
  opacity: 1;
}
#password-input{
  width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #2b315f; background:#0e1430; color:#e7e9f7;
}
#password-toggle{ font-size: 16px; }
</style><style id="standings-points-emphasis">
/* === Classement: centré + pastille Points discrète + liserets groupés === */

/* Centre tout le tableau */
#table-classement thead th{ text-align:center; }
#table-classement tbody td{ text-align:center; }

/* Centre le contenu "Équipe" */
#table-classement tbody td:nth-child(2) .team-name{ justify-content:center; }

/* Pas de liserets dans l'en-tête */
#table-classement thead th{ border-right:none !important; border-left:none !important; }

/* Liserets groupés :
   - Sports : Fléchettes(4) | Ping(5) | Palet(6)
   - Bonus/Malus : Bonus(7) | Malus(8)
*/
#table-classement tbody td:nth-child(4){ border-left: 1px solid rgba(255,255,255,.10); }
#table-classement tbody td:nth-child(6){ border-right:1px solid rgba(255,255,255,.10); }
#table-classement tbody td:nth-child(7){ border-left: 1px solid rgba(255,255,255,.10); }
#table-classement tbody td:nth-child(8){ border-right:1px solid rgba(255,255,255,.10); }

/* Pastille discrète pour la colonne Points (col 3) */
#table-classement thead th:nth-child(3){ text-align:center; }
#table-classement tbody td:nth-child(3){ position:relative; font-weight:900; }

#table-classement tbody td:nth-child(3) > span.points-medal{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:44px; height:30px; padding:0 10px; border-radius:999px;
  font-size:16px; font-weight:800; letter-spacing:.2px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.18);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.22); /* keep existing shadow */
}

/* Survol : très léger contraste */
#table-classement tbody tr:hover td:nth-child(3) > span.points-medal{
  background:rgba(255,255,255,.06);
  border-color:rgba(255,255,255,.22);
}

/* Mobile */
@media (max-width:520px){
  #table-classement tbody td:nth-child(3) > span.points-medal{
    min-width:40px; height:28px; padding:0 8px; font-size:15px;
  }
}
</style>

<style id="classement-tweaks">
  /* Align everything to the left in the classement table */
  #table-classement th,
  #table-classement td{ text-align:left; }

  /* Keep team row visuals but ensure left alignment with consistent spacing */
  #table-classement td:nth-child(2) .team-name{
    display:inline-flex; align-items:center; gap:8px;
    vertical-align:middle;
  }

  /* Bigger emojis in the rank column */
  #table-classement td:first-child{
    font-size:1.4em; /* larger only for emoji */
    line-height:1.1;
  }

  /* Points pill — more visible without changing base font size */
  #table-classement td.points-cell .points-pill{
    display:inline-block;
    padding:2px 10px;
    border-radius:9999px;
    background:#EEF2FF;          /* soft indigo */
    border:1px solid #C7D2FE;    /* indigo-200 */
    color:#1E3A8A;               /* indigo-900 */
    box-shadow:0 1px 0 rgba(30,58,138,.08), inset 0 0 0 1px rgba(255,255,255,.4);
  }
</style>

<style id="classement-align-left-and-strong-points-v2">
  /* 1) CLASSEMENT — tout à gauche, sauf le rang (#) que l’on garde centré */
  #table-classement thead th,
  #table-classement tbody td{
    text-align: left !important;
  }
  #table-classement tbody td:first-child{
    text-align: center !important; /* garde la colonne # centrée */
  }

  /* Équipe : avatar + nom alignés à gauche */
  #table-classement tbody td:nth-child(2) .team-name{
    display: inline-flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-start !important;
  }

  /* 2) POINTS — pastille bien plus visible */
  #table-classement thead th:nth-child(3){ text-align: left !important; }
  #table-classement tbody td:nth-child(3){ text-align: left !important; }

  #table-classement tbody td:nth-child(3) > span.points-medal{
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 56px;
    height: 34px;
    padding: 0 12px;
    border-radius: 999px;
    font-size: 18px;
    font-weight: 900;
    letter-spacing: .3px;
    background: linear-gradient(180deg, #c9d6ff 0%, #a9bbff 100%);
    color: #0b1450;
    border: 1px solid #9ab4ff;
    box-shadow:
      0 4px 12px rgba(75,139,255,.25),
      inset 0 0 0 1px rgba(255,255,255,.6);
  }

  /* Mobile : réduit un peu la taille de la pastille */
  @media (max-width:520px){
    #table-classement tbody td:nth-child(3) > span.points-medal{
      min-width: 48px;
      height: 30px;
      padding: 0 10px;
      font-size: 16px;
    }
  }
</style>

<style id="classement-center-stats-cols">
  /* Garder ces colonnes centrées : fléchettes (4), ping-pong (5), palet (6), bonus (7), malus (8), matchs complets (9) */
  #table-classement thead th:nth-child(4),
  #table-classement thead th:nth-child(5),
  #table-classement thead th:nth-child(6),
  #table-classement thead th:nth-child(7),
  #table-classement thead th:nth-child(8),
  #table-classement thead th:nth-child(9),
  #table-classement tbody td:nth-child(4),
  #table-classement tbody td:nth-child(5),
  #table-classement tbody td:nth-child(6),
  #table-classement tbody td:nth-child(7),
  #table-classement tbody td:nth-child(8),
  #table-classement tbody td:nth-child(9) {
    text-align: center !important;
    justify-content: center !important;
  }
</style>

<style id="gta-tabs">
/* ===== Onglets style "GTA" — version blanche lisible =================== */
@import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');

.tab.gta{
  /* Nouvelle police + lisibilité */
  font-family: "Bangers","Impact","Arial Black",system-ui,sans-serif;
  text-transform: uppercase;
  letter-spacing: .6px;
  font-weight: 900;
  font-size: 16px;

  /* Capsule blanche à contour noir */
  border-radius: 999px;
  padding: 9px 17px;
  background: #ffffff;
  color: #111111;
  border: 3px solid #000000;

  /* Ombres très légères pour le relief, sans altérer le contraste */
  box-shadow:
    0 2px 0 rgba(0,0,0,.35),
    0 8px 18px rgba(0,0,0,.18);
  transition: transform .06s ease, box-shadow .18s ease, background .18s ease, filter .18s ease;
}
.tab.gta:hover{
  transform: translateY(-1px);
  background: #fefefe;
  box-shadow:
    0 3px 0 rgba(0,0,0,.38),
    0 12px 22px rgba(0,0,0,.22);
}
.tab.gta:active{
  transform: translateY(0);
  box-shadow:
    0 2px 0 rgba(0,0,0,.35),
    0 8px 16px rgba(0,0,0,.20);
}

/* Onglet actif : léger halo bleu mais fond reste blanc */
.tab.gta[aria-selected="true"]{
  background: #ffffff;
  box-shadow:
    0 3px 0 rgba(0,0,0,.38),
    0 0 0 3px rgba(59,130,246,.18),
    0 14px 28px rgba(59,130,246,.22);
}

/* Petits boutons/puces à droite du header */
.header-chip.gta{
  font-family: "Bangers","Impact","Arial Black",system-ui,sans-serif;
  text-transform: uppercase;
  font-weight: 900;
  font-size: 14px;

  border-radius: 999px;
  padding: 8px 14px;
  background: #ffffff;
  color: #111111 !important;
  border: 3px solid #000000;
  box-shadow: 0 2px 0 rgba(0,0,0,.35), 0 8px 18px rgba(0,0,0,.18);
  transition: transform .06s ease, box-shadow .18s ease, background .18s ease;
}
.header-chip.gta:hover{
  transform: translateY(-1px);
  background: #fefefe;
  box-shadow: 0 3px 0 rgba(0,0,0,.38), 0 12px 22px rgba(0,0,0,.22);
}

@media (prefers-reduced-motion: reduce){
  .tab.gta, .header-chip.gta{ transition: none; }
}
</style>

<style id="gta-selected-and-classement-dark">
:root{
  /* Rouge-violet désaturé (crimson violet) */
  --gta-active: #c03a8f;        /* crimson-violet */
  --gta-active-strong: #8a2cab; /* purple-lean */
}

/* === GTA tabs — actif crimson-violet + transparence accrue ============ */
.tab.gta[aria-selected="true"]{
  background: linear-gradient(
    180deg,
    rgba(192, 58, 143, .70),
    rgba(138, 44, 171, .70)
  );
  color: #ffffff;
  -webkit-text-fill-color: #ffffff;
  border-color: #000000;
  box-shadow:
    0 2px 0 rgba(0,0,0,.32),
    0 0 0 2px rgba(0,0,0,.12) inset,
    0 10px 18px rgba(192,58,143,.18);
  backdrop-filter: saturate(105%) blur(2px);
}
.tab.gta[aria-selected="true"]:hover{
  background: linear-gradient(
    180deg,
    rgba(192, 58, 143, .78),
    rgba(138, 44, 171, .78)
  );
}

/* === Fonds "noir translucide" — partout (inchangés) ==================== */
.card,
.match-card{
  background: rgba(8, 10, 16, .62) !important;
  border-color: rgba(26, 28, 34, .75) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  backdrop-filter: blur(6px) saturate(110%);
}
.card .hd,
.match-card .hd{
  background: transparent !important;
  border-bottom-color: rgba(26,28,34,.75) !important;
}
.card table thead th{
  background: rgba(10,12,18,.66) !important;
  border-bottom-color: rgba(26,28,34,.75) !important;
  backdrop-filter: blur(6px) saturate(110%);
}
.card table tbody tr{
  background: rgba(10,12,18,.58) !important;
  box-shadow: 0 1px 0 rgba(0,0,0,.25) inset, 0 0 0 1px rgba(255,255,255,.02);
}
#table-classement tbody tr:nth-child(1){ box-shadow: inset 4px 0 0 0 rgba(212,175,55,.9), 0 1px 0 rgba(0,0,0,.25) inset, 0 0 0 1px rgba(255,255,255,.02); }
#table-classement tbody tr:nth-child(2){ box-shadow: inset 4px 0 0 0 rgba(192,192,192,.9), 0 1px 0 rgba(0,0,0,.25) inset, 0 0 0 1px rgba(255,255,255,.02); }
#table-classement tbody tr:nth-child(3){ box-shadow: inset 4px 0 0 0 rgba(205,127,50,.9), 0 1px 0 rgba(0,0,0,.25) inset, 0 0 0 1px rgba(255,255,255,.02); }
</style>

</head></html>
<style id="rencontres-polish">
/* Card container */
.matches, .calendar, .journees, .games { gap: 20px; }
.scorewrap, .match, .match-card {
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 14px 16px;
  box-shadow: 0 4px 18px rgba(0,0,0,.25); /* keep existing shadow */
}

/* Header line */
.scorewrap .teams-row{
  grid-template-columns: 1.2fr auto 1.2fr !important;
  gap: 20px !important;
}

/* Team cell */
.scorewrap .team{ gap: 12px !important; }
.scorewrap .team .avatar, .scorewrap .team .avatar img{
  width: 56px !important; height: 56px !important; border-radius: 50%;
}

/* Team name */
.scorewrap .team .name{ font-size: 20px; font-weight: 700; line-height: 1.1; }

/* Score core */
.scorewrap .score{
  font-weight: 900 !important;
  font-size: 36px !important;
  letter-spacing: 2px;
  min-width: 120px;
}

/* Little sport pills below */
.scorewrap .meta, .scorewrap .sub {
  display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;
}
.scorewrap .pill{
  padding: 4px 8px !important;
  font-size: 12px !important;
  opacity: .95;
  border-radius: 999px !important;
  box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset; /* keep existing shadow */
}

/* Action row (play / expand) */
.scorewrap .actions{ display:flex; align-items:center; gap:10px; margin-top:8px; }
.scorewrap .actions .btn, .scorewrap .actions button{
  border-radius: 999px;
}

/* Collapsed details panel */
.scorewrap [aria-expanded="true"] + .details,
.match-card[aria-expanded="true"] .details {
  max-height: 600px; transition: max-height .35s ease;
}
.scorewrap [aria-expanded="false"] + .details,
.match-card[aria-expanded="false"] .details {
  max-height: 0; overflow: hidden; transition: max-height .25s ease;
}

/* Hover polish */
.scorewrap:hover{ transform: translateY(-1px); transition: transform .15s ease; }
</style>
<style id="score-entry-compact">
/* Chip état Complet/Incomplet */
.state-chip{font-weight:700;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.1);}
.state-chip.ok{background:rgba(67,200,89,.15);box-shadow:0 0 0 1px rgba(67,200,89,.25) inset}
.state-chip.warn{background:rgba(255,170,25,.12); /* keep existing shadow */box-shadow:0 0 0 1px rgba(255,170,25,.25) inset}

/* Bandeau de saisie (plus compact) */
.match-two-col{display:grid; /* keep existing shadow */grid-template-columns:1fr 1fr;gap:12px}
.sport-group{background:transparent;border:0;padding:0;margin:0}
.sport-title{font-size:13px;font-weight:700;margin:0 0 6px 0;opacity:.9}
.sport-item{display:grid;grid-template-columns:auto 1fr;align-items:center;gap:8px;margin:4px 0}
.sport-item label{font-size:12px;opacity:.9;white-space:nowrap}
.sport-item select,.sport-item input{height:30px;padding:0 8px;border-radius:10px}

/* Palet ligne compacte */
.palet-inline{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.palet-inline input{width:52px;text-align:center}

/* Réduire les marges globales du panneau */
.match-card .bd{padding:8px 10px}
</style>
<style id="round-head-style">
.round-head{display:flex;align-items:center;gap:10px;margin:18px 0 10px 0;padding-top:8px;border-top:1px solid rgba(255,255,255,.08)}
.round-head .round-title{font-weight:700;font-size:18px}
/* Séparation visuelle forte entre journées */
.round-grid{margin-bottom:26px;padding-bottom:8px}
/* Masquer la pastille #n dans chaque match (on ne la veut qu'en tête de journée) */
.scorewrap .left-rail .round-chip{display:none !important;}
</style>
<style id="round-grid-divider-and-names">
/* Filet vertical entre les 2 colonnes */
.round-grid{ position:relative; }
.round-grid::before{
  content:"";
  position:absolute; top:0; bottom:0; left:50%;
  width:1px;
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.08), rgba(255,255,255,.04));
  transform: translateX(-0.5px);
  pointer-events:none;
}
@media (max-width: 900px){
  .round-grid::before{ display:none; }
}

/* Noms d'équipe adaptatifs + ellipsis */
.scorewrap .team{ min-width:0; }
.scorewrap .team .name{
  font-size: clamp(14px, 2vw, 18px);  /* s’adapte selon la largeur */
  max-width: 12ch;                    /* borne pour éviter les débordements */
  white-space: nowrap; max-width: calc(100vw - 32px);
  overflow: hidden;
  text-overflow: ellipsis;
}
/* Si l’espace est plus large (grand écran), autoriser un peu plus */
@media (min-width: 1400px){
  .scorewrap .team .name{ max-width: 16ch; font-size: clamp(14px, 1.6vw, 20px); }
}
</style>
<style id="match-cards-equalized">
/* === 1) Tailles identiques des cartes par ligne === */
.round-grid{
  /* chaque ligne prend la hauteur du match le plus grand */
  grid-auto-rows: 1fr;
  align-items: stretch;
}
.round-grid .match-card{
  height: 100%;
  display: flex;
  flex-direction: column;
}
.round-grid .match-card .hd{ /* en-tête */
  padding-bottom: 10px;
}
.round-grid .match-card .bd{ /* contenu extensible */
  margin-top: auto;   /* pousse le bas pour équilibrer */
}

/* === 2) Pilule Complet/Incomplet ne chevauche pas les scores des sports === */
.scorewrap .state-chip{
  display: inline-block;
  margin-top: 10px;   /* sous la ligne des pastilles de sports */
}
/* assure une vraie ligne pour les pastilles sport -> puis la pilule état sous la ligne */
.scorewrap .meta, .scorewrap .sub{
  margin-bottom: 2px;
}

/* === 3) Densifier l'espacement entre journées === */
.round-head{ margin: 4px 0 6px 0; padding-top: 4px; }
.round-grid{ margin-bottom: 4px; padding-bottom: 4px; }
</style>
<style id="match-cards-equal-width">
/* Forcer des largeurs identiques pour chaque carte dans la grille */
.round-grid{
  grid-template-columns: repeat(2, minmax(0, 1fr));
}
.round-grid > .match-card{
  width: 100%;
  min-width: 0;           /* évite que du contenu force la colonne */
  margin: 0 !important;   /* pas de marge parasite */
  box-sizing: border-box;
}
/* s'assurer que le contenu interne ne crée pas une largeur différente */
.round-grid > .match-card .scorewrap{
  width: 100%;
  box-sizing: border-box;
}
/* Mobile: 1 colonne = pleine largeur */
@media (max-width: 900px){
  .round-grid{ grid-template-columns: 1fr; }
}
</style>
<style id="bonus-flashy-pill">
.pill.bonus-flashy{
  background: linear-gradient(180deg, rgba(80,180,255,.25), rgba(80,180,255,.15));
  border: 1px solid rgba(120,200,255,.45);
  box-shadow: 0 6px 18px rgba(0,120,255,.25), 0 0 0 1px rgba(0,120,255,.25) inset; /* keep existing shadow */
  font-weight: 800;
}
.pill.bonus-flashy .pos{ color: #5CF08A; font-weight: 800; margin-left: 6px; }
.pill.bonus-flashy .neg{ color: #FF6B6B; font-weight: 800; margin-left: 6px; }
.pill.bonus-flashy .mini-bonus{ width: 18px; height: 18px; border-radius: 50%; overflow: hidden; vertical-align: -3px; margin-left: 6px; }
.pill.bonus-flashy:hover{ filter: brightness(1.1); box-shadow: 0 8px 22px rgba(0,140,255,.35), 0 0 0 1px rgba(120,200,255,.6) inset; /* keep existing shadow */ }
</style>
<style id="equal-visual-heights">
.scorewrap .teams-row{ align-items:center; min-height: 84px; }
.scorewrap .score{ font-size: clamp(28px, 3.2vw, 34px) !important; line-height:1; }
.scorewrap .team .name{ font-size: clamp(15px, 1.4vw, 18px); }
</style>
<style id="bonus-flashy-anim-tooltip">
/* Pop-in animation */
@keyframes bonusPop { 
  0% { transform: scale(.85); opacity: .0; filter: saturate(0.8) blur(.2px); } 
  60% { transform: scale(1.04); opacity: 1; } 
  100% { transform: scale(1); opacity: 1; } 
}
.pill.bonus-flashy{ animation: bonusPop .26s ease-out; position: relative; z-index: 0; }

/* Color variants */
.pill.bonus-flashy.pos{
  background: linear-gradient(180deg, rgba(40,200,120,.22), rgba(40,200,120,.14));
  border: 1px solid rgba(60,220,140,.55);
  box-shadow: 0 8px 22px rgba(40,200,120,.28), 0 0 0 1px rgba(60,220,140,.55) inset; /* keep existing shadow */
}
.pill.bonus-flashy.neg{
  background: linear-gradient(180deg, rgba(255,120,120,.22), rgba(255,120,120,.14));
  border: 1px solid rgba(255,110,110,.55);
  box-shadow: 0 8px 22px rgba(255,120,120,.30), 0 0 0 1px rgba(255,110,110,.55) inset; /* keep existing shadow */
}

/* Custom tooltip bubble */

</style>
<style id="score-boxes-and-tooltip-align">
/* Score en boîtes blanches */
.score{ display:flex; align-items:center; gap:10px; justify-content:center; }
.score .dash{ font-weight:900; opacity:.85; }
.score .scorebox{
  background: linear-gradient(180deg, #fff, #f1f1f1);
  color:#111;
  border-radius:12px;
  padding: 6px 14px;
  min-width: 54px;
  text-align:center;
  font-weight: 900;
  box-shadow: 0 3px 10px rgba(0,0,0,.15), 0 0 0 1px rgba(0,0,0,.05) inset; /* keep existing shadow */
}

/* Tooltip alignment per column */
.round-grid{ position:relative; }
.round-grid > .match-card:nth-child(odd) 
.round-grid > .match-card:nth-child(odd) 
.round-grid > .match-card:nth-child(even) 
.round-grid > .match-card:nth-child(even) 
/* On mobile, centre le tooltip */
@media (max-width: 900px){
  .round-grid > .match-card 
  .round-grid > .match-card 
}

/* Ajuste la taille des chiffres dans la boîte */
.score .scorebox{ font-size: clamp(22px, 3.2vw, 34px); line-height:1; }
</style>
<style id="scoreboxes-tight-font">
/* Fonts proches d'un tableau de score */
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Roboto+Condensed:wght@700&display=swap');

.score{ display:flex; align-items:center; gap:0; justify-content:center; }
.score .scorebox{
  background: linear-gradient(180deg, #fff, #f2f2f2);
  color:#111;
  padding: 10px 18px;
  min-width: 62px;
  text-align:center;
  font-weight: 900;
  font-family: 'Anton','Roboto Condensed','Impact','Arial Narrow',sans-serif;
  letter-spacing: .5px;
  font-size: clamp(26px, 3.6vw, 40px);
  line-height: 1;
}
.score .scorebox.a{ border-radius: 10px 0 0 10px; }
.score .scorebox.b{ border-radius: 0 10px 10px 0; }
/* couture centrale comme sur la photo */
.score .scorebox.b{ box-shadow: inset 2px 0 0 0 rgba(0,0,0,.35); /* keep existing shadow */ }
.score .scorebox.a{ box-shadow: inset -2px 0 0 0 rgba(0,0,0,.22); /* keep existing shadow */ }
</style>
<style id="bonus-flashy-blue-variant">
.pill.bonus-flashy{
  background: linear-gradient(180deg, rgba(60,120,255,.22), rgba(60,120,255,.14));
  border: 1px solid rgba(110,160,255,.55);
  box-shadow: 0 8px 22px rgba(60,120,255,.28), 0 0 0 1px rgba(110,160,255,.55) inset; /* keep existing shadow */
  font-weight: 800; position:relative;
}
/* halo/bord coloré selon pos/neg */
.pill.bonus-flashy.pos{ border-color: rgba(60,220,140,.85); box-shadow: 0 8px 22px rgba(40,200,120,.28), 0 0 0 2px rgba(60,220,140,.55) inset; /* keep existing shadow */ }
.pill.bonus-flashy.neg{ border-color: rgba(255,110,110,.9); box-shadow: 0 8px 22px rgba(255,120,120,.30), 0 0 0 2px rgba(255,110,110,.55) inset; /* keep existing shadow */ }
.pill.bonus-flashy .pos{ color: #5CF08A; font-weight: 900; margin-left: 6px; }
.pill.bonus-flashy .neg{ color: #FF6B6B; font-weight: 900; margin-left: 6px; }
</style>
<style id="scoreboxes-seam-stronger">
.score{ position:relative; }
.score::before{
  content:""; position:absolute; top:8%; bottom:8%; left:50%;
  width:1px; background: rgba(0,0,0,.45);
  transform: translateX(-0.5px);
  border-radius: 1px;
}
</style>
<style id="score-seam-simple">
/* Simple filet noir au centre du bloc score */
.score .scorebox.a, .score .scorebox.b{ box-shadow: none !important; /* keep existing shadow */ }
.score{ position:relative; }
.score::before{
  content:""; position:absolute; top:10%; bottom:10%; left:50%;
  width:2px; background:#000; transform: translateX(-1px);
  border-radius: 1px;
}
</style>
<style id="bonus-sport-emoji-css">
.pill .sport-emo{ margin: 0 6px 0 4px; font-size: 14px; line-height: 0; vertical-align: -1px; }
</style>
<style id="tooltip-visibility-fix">
.match-card, .scorewrap, .round-grid { overflow: visible !important; }
.pill.bonus-flashy{ position:relative; z-index: 50; }
.pill.bonus-flashy[data-tip]::after,
.pill.bonus-flashy[data-tip]::before{ z-index: 1000; }
</style>
<style id="bonus-pill-compact">
.pill.bonus-flashy{ padding: 4px 8px; white-space: nowrap; font-size: 13px; }
.pill.bonus-flashy .mini-bonus{ width: 14px; height: 14px; margin: 0 4px; vertical-align: -2px; }
.pill .sport-emo{ margin: 0 4px 0 3px; font-size: 13px; vertical-align: -1px; }
.pill.bonus-flashy .pos, .pill.bonus-flashy .neg{ margin-left: 3px; }
</style>
<style id="bonus-pill-order-tight">
.pill.bonus-flashy, .pill.blue{ display:inline-flex; align-items:center; gap:4px; }
.pill.bonus-flashy .mini-bonus, .pill.blue .mini-bonus{ margin:0 2px; }
.pill .sport-emo{ margin:0 2px; }
</style>
<style id="chev-bottom-right">
.match-card .hd{ position: relative; }
.match-card .hd .chev{
  position: absolute; right: 14px; bottom: 12px; top: auto;
  transform: none;
}
.match-card[aria-expanded="true"] .hd .chev{ transform: rotate(90deg); }
</style>
<style id="incomplete-pulse">
@keyframes chipWarnPulse { 0%{ box-shadow:0 0 0 0 rgba(255,180,0,.0); /* keep existing shadow */} 50%{ box-shadow:0 0 0 6px rgba(255,180,0,.22); /* keep existing shadow */} 100%{ box-shadow:0 0 0 0 rgba(255,180,0,.0); /* keep existing shadow */} }
.chip.warn.pulse{ animation: chipWarnPulse .6s ease-out 1; }
</style>

<style id="ts-popover-styles">
/* Accessible Popover (progressive enhancement)
   Upgrades any element with [data-popover] || legacy [data-tip]. */
.ts-popover {
  position: fixed;
  inset: auto auto 0 0;
  max-width: min(92vw, 460px);
  background: #0a0a0a;
  color: #fff;
  font: 500 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  border-radius: 10px;
  padding: 10px 12px;
  box-shadow: 0 10px 28px rgba(0,0,0,.36), 0 0 0 1px rgba(255,255,255,.06) inset; /* keep existing shadow */
  opacity: 0;
  transform: translateY(4px) scale(.98);
  pointer-events: none;
  z-index: 1000;
  transition: opacity .14s ease, transform .14s ease;
}
.ts-popover[data-state="open"]{
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}
.ts-popover[data-placement^="top"] .ts-popover__arrow{ transform: rotate(180deg); }
.ts-popover[data-placement^="left"] .ts-popover__arrow{ transform: rotate(-90deg); }
.ts-popover[data-placement^="right"] .ts-popover__arrow{ transform: rotate(90deg); }

.ts-popover__arrow {
  position: absolute;
  width: 14px;
  height: 14px;
  left: 50%;
  transform: translateX(-50%);
  bottom: -7px;
  filter: drop-shadow(0 2px 3px rgba(0,0,0,.25));
}
.ts-popover__arrow::before{
  content:"";
  position:absolute;
  inset:0;
  background:#111;
  transform: rotate(45deg);
  border-radius: 3px;
  box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset; /* keep existing shadow */
}
/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  .ts-popover{ transition: none; }
}

/* Trigger helpers (optional) */
[aria-haspopup="dialog"][data-popover-state="open"],
[aria-haspopup="tooltip"][data-popover-state="open"]{
  outline: 2px solid rgba(120,160,255,.6);
  outline-offset: 2px;
  border-radius: 10px;
}
</style>

<style id="ts-popover-override-legacy">
.pill.bonus-flashy[data-has-js-popover]::after,
.pill.bonus-flashy[data-has-js-popover]::before{ display:none !important; content:none !important; }
</style>

<script id="ts-popover-script">
(function(){
  const PADDING = 12; // viewport padding
  let current = null;
  const popover = document.createElement('div');
  popover.className = 'ts-popover';
  popover.setAttribute('role', 'tooltip');
  popover.innerHTML = '<div class="ts-popover__content"></div><div class="ts-popover__arrow" aria-hidden="true"></div>';
  const contentEl = popover.querySelector('.ts-popover__content');
  document.addEventListener('DOMContentLoaded', () => {
    // Upgrade legacy [data-tip] to [data-popover]
    document.querySelectorAll('[data-tip]').forEach(el => {
      if(!el.hasAttribute('data-popover')){
        el.setAttribute('data-popover', el.getAttribute('data-tip'));
      }
      // Remove legacy CSS-only tooltip by disabling ::after/::before via marker
      el.setAttribute('data-has-js-popover', 'true');
    });

    // Attach events
    const triggers = Array.from(document.querySelectorAll('[data-popover]'));
    if (!triggers.length) return;
    document.body.appendChild(popover);

    const open = (el, viaClick=false) => {
      if (current === el) return;
      close();
      current = el;
      const text = el.getAttribute('data-popover');
      if (!text) { current = null; return; }
      contentEl.textContent = text;
      // ARIA
      let id = el.getAttribute('aria-describedby');
      if (!id) {
        id = 'ts-popover-' + Math.random().toString(36).slice(2);
        popover.id = id;
        el.setAttribute('aria-describedby', id);
      } else {
        popover.id = id;
      }
      el.setAttribute('data-popover-state','open');
      place(el);
popover.setAttribute('data-placement','bottom');
popover.setAttribute('data-state','open');
      // If opened by click/touch, trap dismissal with outside click
      if (viaClick) {
        setTimeout(()=>document.addEventListener('pointerdown', onDocPointerDown, { once:true }), 0);
      }
    };

    const close = () => {
      if (!current) return;
      current.removeAttribute('data-popover-state');
      current = null;
      popover.removeAttribute('data-state');
    };

    const onDocPointerDown = (e) => {
      if (!popover.contains(e.target) && (!current || !current.contains(e.target))) {
        close();
      }
    };

    
const place = (el) => {
  const rect = el.getBoundingClientRect();
  const vw = document.documentElement.clientWidth;
  const vh = document.documentElement.clientHeight;
  const popW = Math.min(460, vw - PADDING*2);
  popover.style.maxWidth = popW + 'px';
  // Ensure measurable size before positioning
  popover.style.left = '0px';
  popover.style.top = '0px';
  popover.setAttribute('data-placement','bottom');
  // compute content size after setting content
  const margin = 10;
  const popH = popover.offsetHeight || 0;

  // Horizontal centering with clamping
  let left = rect.left + rect.width/2 - popW/2;
  left = Math.max(PADDING, Math.min(left, vw - PADDING - popW));

  // Force below the trigger
  let top = rect.bottom + margin;
  // Clamp to viewport bottom with padding
  top = Math.min(vh - PADDING - popH, top);

  popover.style.transformOrigin = 'center top';
  popover.style.left = left + 'px';
  popover.style.top = top + 'px';

  // Arrow X based on trigger center
  const arrow = popover.querySelector('.ts-popover__arrow');
  const centerX = rect.left + rect.width/2;
  const arrowLeft = Math.max(14, Math.min(popW - 14, centerX - left));
  arrow.style.left = arrowLeft + 'px';
  arrow.style.top = (-7) + 'px';
};

    // Hover/focus show, leave/blur hide
    const show = (e) => open(e.currentTarget, e.type === 'click');
    const hide = () => close();

    triggers.forEach(el => {
      el.setAttribute('tabindex', el.tabIndex >= 0 ? el.tabIndex : 0);
      el.setAttribute('aria-haspopup','tooltip');
      el.addEventListener('mouseenter', show);
      el.addEventListener('focusin', show);
      el.addEventListener('mouseleave', hide);
      el.addEventListener('focusout', hide);
      el.addEventListener('click', (e)=>{
        // Toggle on click/touch
        if (current === el) { close(); }
        else { open(el, true); }
      });
    });

    window.addEventListener('resize', () => { if (current) place(current); });
    window.addEventListener('scroll', () => { if (current) place(current); }, true);

    // Esc to close
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') close();
    });
  });
})();
</script>