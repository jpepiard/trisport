<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tournoi Trisport — Bonus Melon d’or</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#121836;
      --panel-2:#0f1430;
      --text:#f2f4ff;
      --muted:#aab2d8;
      --accent:#7bd88f;
      --accent-2:#78c3ff;
      --danger:#ff6b6b;
      --warning:#ffd166;
      --chip:#223059;
      --chip-ok:#204c3b;
      --chip-bad:#4c2031;
      --input:#1a2150;
      --border:#273069;
      --shadow: 0 6px 20px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 900px at 20% -10%, #1a2251 0%, #0b1020 50%) no-repeat fixed;
    }
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:16px 20px;background:color-mix(in hsl, var(--panel), #000 10%);
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
    }
    h1{font-size:22px;margin:0;letter-spacing:.2px}
    .teams{
      display:grid;grid-template-columns:1fr 1fr;gap:12px; width: clamp(280px, 48vw, 500px);
    }
    .teams .input{
      display:flex;gap:8px;align-items:center;background:var(--panel-2);
      border:1px solid var(--border); border-radius:12px; padding:8px 10px;
    }
    .teams input{
      flex:1; background:transparent;color:var(--text); border:0; outline:none;font-weight:600;
    }
    .btn{
      appearance:none;border:0; background:linear-gradient(180deg, #6da8ff, #3879ff);
      color:white; font-weight:700; padding:10px 14px; border-radius:12px; cursor:pointer;
      box-shadow:0 6px 14px rgba(56,121,255,.35);
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.secondary{background:linear-gradient(180deg, #7bd88f, #28b463); box-shadow:0 6px 14px rgba(40,180,99,.35)}
    .btn.ghost{background:transparent;border:1px solid var(--border); box-shadow:none}
    .grid{display:grid;gap:12px}
    .rounds{margin-top:18px}
    .card{
      background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow);
    }
    .round-head{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:8px;
    }
    .round-title{font-weight:800; letter-spacing:.3px}
    .sports{ display:grid; grid-template-columns:1fr; gap:10px; margin:6px 0 10px}
    .sport-row{
      display:grid; grid-template-columns: 160px repeat(2, minmax(0,1fr)); gap:10px; align-items:center;
      background:var(--panel-2); border:1px solid var(--border); border-radius:12px; padding:10px;
    }
    .sport-name{font-weight:700;color:var(--muted)}
    .scorebox{
      display:flex; gap:8px; align-items:center; background:var(--input); border:1px solid var(--border); border-radius:10px; padding:8px;
    }
    .scorebox label{font-size:12px; color:var(--muted)}
    .scorebox input{
      width:100%; background:transparent; border:0; outline:none; color:var(--text);
      font-weight:800; font-size:18px; text-align:right;
    }
    .bonus{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:8px;
    }
    .bonus .bonus-slot{
      background:var(--panel-2); border:1px solid var(--border); border-radius:12px; padding:10px;
    }
    .bonus .slot-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px}
    .team-badge{
      font-weight:800; background:var(--chip); border:1px solid var(--border); padding:6px 10px; border-radius:999px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:6px; border-radius:999px; padding:6px 10px;
      background:var(--chip); border:1px solid var(--border); color:var(--text); font-weight:700; font-size:13px;
    }
    .chip.ok{ background:var(--chip-ok); border-color:#2d6f5a }
    .chip.bad{ background:var(--chip-bad); border-color:#6f2d43 }
    .select{ width:100%; padding:8px 10px; font-weight:700; color:var(--text); background:var(--input); border:1px solid var(--border); border-radius:10px; outline:none }
    .actions{ display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; margin-top:10px }
    .leader{
      margin-top:18px; display:grid; grid-template-columns:1fr 1fr; gap:12px;
    }
    .leader .stat{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow); }
    .stat h3{ margin:0 0 10px; font-size:14px; color:var(--muted) }
    .stat .big{ font-size:32px; font-weight:900 }
    .stat .breakdown{ color:var(--muted); font-size:12px; margin-top:8px; white-space:pre-line }
    .muted{ color:var(--muted) }
    .melon{ width:16px; height:16px; display:inline-block; vertical-align:-2px }
    .melon svg{ width:16px; height:16px; display:block }
    .footer-note{ color:#9fb0ff; font-size:12px; margin-top:8px }
    .divider{ height:1px; background:var(--border); margin:12px 0 }
    .disabled{ opacity:.6; pointer-events:none }
    @media (min-width: 920px){
      .sports{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <h1>Tournoi Trisport <span class="muted">— Bonus <strong>Melon d’or</strong></span></h1>
      <div class="teams">
        <div class="input">
          <span class="team-badge">Équipe A</span>
          <input id="teamA" value="Équipe 1" aria-label="Nom équipe A" />
        </div>
        <div class="input">
          <span class="team-badge">Équipe B</span>
          <input id="teamB" value="Équipe 2" aria-label="Nom équipe B" />
        </div>
      </div>
      <button id="addRound" class="btn">Ajouter une journée</button>
    </header>

    <section class="leader">
      <div class="stat">
        <h3>Score total — <span id="nameA">Équipe 1</span></h3>
        <div class="big" id="totalA">0</div>
        <div class="breakdown" id="breakA"></div>
      </div>
      <div class="stat">
        <h3>Score total — <span id="nameB">Équipe 2</span></h3>
        <div class="big" id="totalB">0</div>
        <div class="breakdown" id="breakB"></div>
      </div>
    </section>

    <section class="rounds" id="rounds"></section>

    <p class="footer-note">Règle du <strong>Melon d’or</strong> :
      victoire dans le sport choisi ⇒ on ajoute un bonus égal à vos points dans ce sport (effet “doublé”).
      Défaite ⇒ malus égal à <em>2 × l’écart</em>. Égalité ⇒ 0.
    </p>
  </div>

  <!-- Petit pictogramme melon en SVG inline -->
  <template id="melon-svg">
    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#7bd88f"/><stop offset="1" stop-color="#2fad66"/>
        </linearGradient>
      </defs>
      <circle cx="32" cy="32" r="26" fill="url(#g)" stroke="#1f6b43" stroke-width="3"/>
      <path d="M12 32c8 10 32 10 40 0" fill="none" stroke="#0f4f34" stroke-width="3" stroke-linecap="round"/>
      <path d="M32 7c-1 5 3 8 8 8" fill="none" stroke="#23653f" stroke-width="3" stroke-linecap="round"/>
    </svg>
  </template>

  <script>
    const state = {
      teams: { A: "Équipe 1", B: "Équipe 2" },
      rounds: [] // { id, finished, scores:{darts:{A,B}, ping:{A,B}, palet:{A,B}}, melon:{A:null|'darts'|'ping'|'palet', B:...}, applied:{A,B} }
    };

    const SPORT_LABEL = { darts: "Fléchettes", ping: "Ping", palet: "Palet" };

    // Utils
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const parseNum = v => { const n = Number(v); return Number.isFinite(n) ? n : 0; };
    const otherTeam = t => (t === 'A' ? 'B' : 'A');

    function melonIcon() {
      const tpl = $('#melon-svg'); return tpl ? tpl.content.firstElementChild.cloneNode(true) : null;
    }

    // --- Model ops ---
    function addRound() {
      const id = state.rounds.length + 1;
      state.rounds.push({
        id, finished:false,
        scores:{ darts:{A:0,B:0}, ping:{A:0,B:0}, palet:{A:0,B:0} },
        melon:{ A:null, B:null },
        applied:{ A:0, B:0 }
      });
      render();
    }

    function computeMelonBonusForRound(r, team){
      const pick = r.melon[team];
      if(!pick) return 0;
      const my = r.scores[pick][team];
      const op = r.scores[pick][otherTeam(team)];
      if(my > op) return my;             // victoire ⇒ +vos points
      if(my < op) return -2 * (op - my); // défaite ⇒ -2 × écart
      return 0;                          // égalité ⇒ 0
    }

    function roundTotalBase(r, team){
      const s = r.scores;
      return s.darts[team] + s.ping[team] + s.palet[team];
    }

    function recalcTotals(){
      let totA=0, totB=0;
      let detailA=[], detailB=[];
      state.rounds.forEach(r => {
        const baseA = roundTotalBase(r,'A');
        const baseB = roundTotalBase(r,'B');
        const melonA = r.applied.A;
        const melonB = r.applied.B;
        totA += baseA + melonA;
        totB += baseB + melonB;
        detailA.push(`J${r.id}: base ${baseA}  ${r.finished?`· Melon ${melonA>=0?'+':''}${melonA}`:'· Melon ?'}`);
        detailB.push(`J${r.id}: base ${baseB}  ${r.finished?`· Melon ${melonB>=0?'+':''}${melonB}`:'· Melon ?'}`);
      });
      $('#totalA').textContent = totA;
      $('#totalB').textContent = totB;
      $('#breakA').textContent = detailA.join('\n');
      $('#breakB').textContent = detailB.join('\n');
    }

    // --- UI render ---
    function render(){
      // header names
      $('#nameA').textContent = state.teams.A;
      $('#nameB').textContent = state.teams.B;
      $('#teamA').value = state.teams.A;
      $('#teamB').value = state.teams.B;

      const holder = $('#rounds');
      holder.innerHTML = '';
      state.rounds.forEach(r => holder.appendChild(renderRound(r)));

      recalcTotals();
    }

    function renderRound(r){
      const card = document.createElement('div');
      card.className = 'card';

      // Head
      const head = document.createElement('div');
      head.className = 'round-head';
      head.innerHTML = `<div class="round-title">Journée #${r.id}</div>`;
      card.appendChild(head);

      // Sports grid
      const sports = document.createElement('div');
      sports.className = 'sports';
      sports.appendChild(sportRow('Fléchettes','darts', r));
      sports.appendChild(sportRow('Ping','ping', r));
      sports.appendChild(sportRow('Palet','palet', r));
      card.appendChild(sports);

      // Bonus area
      const bonus = document.createElement('div');
      bonus.className = 'bonus';
      bonus.appendChild(bonusSlot('A', r));
      bonus.appendChild(bonusSlot('B', r));
      card.appendChild(bonus);

      // Actions
      const actions = document.createElement('div');
      actions.className = 'actions';
      const validate = document.createElement('button');
      validate.className = 'btn secondary';
      validate.textContent = r.finished ? 'Journée terminée' : 'Valider la journée';
      validate.disabled = !!r.finished;
      validate.addEventListener('click', () => {
        r.applied.A = computeMelonBonusForRound(r,'A');
        r.applied.B = computeMelonBonusForRound(r,'B');
        r.finished = true;
        render();
      });
      const reset = document.createElement('button');
      reset.className = 'btn ghost';
      reset.textContent = 'Réinitialiser la journée';
      reset.disabled = false;
      reset.addEventListener('click', () => {
        r.scores = { darts:{A:0,B:0}, ping:{A:0,B:0}, palet:{A:0,B:0} };
        r.melon = { A:null,B:null };
        r.applied = { A:0,B:0 };
        r.finished = false;
        render();
      });
      actions.appendChild(reset);
      actions.appendChild(validate);
      card.appendChild(actions);

      if(r.finished){
        card.classList.add('disabled');
      }

      return card;
    }

    function sportRow(label, key, r){
      const row = document.createElement('div');
      row.className = 'sport-row';
      const name = document.createElement('div');
      name.className = 'sport-name';
      name.textContent = label;
      row.appendChild(name);

      const a = document.createElement('div');
      a.className = 'scorebox';
      a.innerHTML = `<label>${state.teams.A}</label><input type="number" min="0" step="1" value="${r.scores[key].A}">`;
      const aInput = a.querySelector('input');
      aInput.addEventListener('input', () => { r.scores[key].A = parseNum(aInput.value); recalcTotals(); });
      aInput.disabled = r.finished;
      row.appendChild(a);

      const b = document.createElement('div');
      b.className = 'scorebox';
      b.innerHTML = `<label>${state.teams.B}</label><input type="number" min="0" step="1" value="${r.scores[key].B}">`;
      const bInput = b.querySelector('input');
      bInput.addEventListener('input', () => { r.scores[key].B = parseNum(bInput.value); recalcTotals(); });
      bInput.disabled = r.finished;
      row.appendChild(b);

      return row;
    }

    function bonusSlot(team, r){
      const slot = document.createElement('div');
      slot.className = 'bonus-slot';

      const head = document.createElement('div'); head.className = 'slot-head';
      const teamBadge = document.createElement('div'); teamBadge.className = 'team-badge';
      teamBadge.textContent = (team==='A'?state.teams.A:state.teams.B);
      head.appendChild(teamBadge);

      const chip = document.createElement('div'); chip.className = 'chip';
      const m = document.createElement('span'); m.className = 'melon'; const icon = melonIcon(); if(icon) m.appendChild(icon);
      const chLabel = document.createElement('span'); chLabel.textContent = 'Bonus Melon d’or';
      chip.appendChild(m); chip.appendChild(chLabel);
      head.appendChild(chip);
      slot.appendChild(head);

      // Select
      const select = document.createElement('select');
      select.className = 'select';
      [['', '— Aucun —'], ['darts','Fléchettes'], ['ping','Ping'], ['palet','Palet']].forEach(([v,lab])=>{
        const o = document.createElement('option'); o.value=v; o.textContent=lab; select.appendChild(o);
      });
      select.value = r.melon[team] || '';
      select.disabled = r.finished;
      select.addEventListener('change', () => { r.melon[team] = select.value || null; render(); });
      slot.appendChild(select);

      // Status line
      const status = document.createElement('div'); status.style.marginTop='8px';
      function refreshStatus(){
        if(!r.finished){
          if(r.melon[team]){
            status.innerHTML = `<span class="chip">Bonus choisi&nbsp;• ${SPORT_LABEL[r.melon[team]]}</span>`;
          }else{
            status.innerHTML = `<span class="muted">Aucun bonus choisi pour cette équipe.</span>`;
          }
        }else{
          const val = r.applied[team] || 0;
          const cls = val>=0 ? 'ok' : 'bad';
          status.innerHTML = `<span class="chip ${cls}">Révélé&nbsp;• ${val>=0?'+':''}${val}</span>`;
        }
      }
      refreshStatus();
      slot.appendChild(status);

      return slot;
    }

    // --- bindings ---
    $('#teamA').addEventListener('input', ()=>{ state.teams.A = $('#teamA').value || 'Équipe 1'; render(); });
    $('#teamB').addEventListener('input', ()=>{ state.teams.B = $('#teamB').value || 'Équipe 2'; render(); });
    $('#addRound').addEventListener('click', addRound);

    // Init
    addRound();
  </script>
</body>
</html>
